/*!
 * Virtual Sky add on to display planets without 
 * needing a file regularly updated from JPL Horizons
 * Written by Stuart Lowe (http://www.strudel.org.uk/)
 */
(function(d){function h(){this.bind("loadedPlanets",function(k){this.jd=this.times.JD;var i=new j();var l=365.25;this.planets=i.build(Math.floor(this.jd)-l*0.25,l*1.25);this.draw()})}function j(){this.planets=[{name:"Me",radius:2439.7,interval:0.5,colour:"rgb(170,150,170)",magnitude:function(i){return -0.36+5*g(i.r*i.R)+0.027*i.FV+2.2e-13*Math.pow(i.FV,6)},elements:[{jd:2456280.5,i:7.0053,o:48.485,p:77.658,a:0.3871,n:4.09232,e:0.205636,L:191.7001},{jd:2456320.5,i:7.0052,o:48.486,p:77.661,a:0.387097,n:4.09236,e:0.205644,L:355.3943},{jd:2456360.5,i:7.0052,o:48.487,p:77.663,a:0.387098,n:4.09235,e:0.205646,L:159.0899},{jd:2456400.5,i:7.0052,o:48.489,p:77.665,a:0.387097,n:4.09236,e:0.205649,L:322.7854},{jd:2456440.5,i:7.0052,o:48.49,p:77.665,a:0.387097,n:4.09236,e:0.20565,L:126.4812},{jd:2456480.5,i:7.0052,o:48.492,p:77.667,a:0.387098,n:4.09235,e:0.205645,L:290.1771},{jd:2456520.5,i:7.0052,o:48.493,p:77.669,a:0.387098,n:4.09235,e:0.205645,L:93.8725},{jd:2456560.5,i:7.0052,o:48.494,p:77.671,a:0.387098,n:4.09235,e:0.205642,L:257.5683},{jd:2456600.5,i:7.0052,o:48.495,p:77.672,a:0.387099,n:4.09234,e:0.205635,L:61.2628},{jd:2456640.5,i:7.0052,o:48.497,p:77.674,a:0.387099,n:4.09233,e:0.205635,L:224.9579},{jd:2456680.5,i:7.0052,o:48.498,p:77.677,a:0.387098,n:4.09234,e:0.205633,L:28.6524}]},{name:"V",radius:6051.9,interval:1,colour:"rgb(245,222,179)",magnitude:function(i){return -4.34+5*g(i.a*i.R)+0.013*i.FV+4.2e-7*Math.pow(i.FV,3)},elements:[{jd:2456280.5,i:3.3949,o:76.797,p:132,a:0.723328,n:1.60214,e:0.006777,L:209.0515},{jd:2456320.5,i:3.3949,o:76.798,p:132.05,a:0.723332,n:1.60213,e:0.00678,L:273.138},{jd:2456360.5,i:3.3949,o:76.799,p:132.07,a:0.723327,n:1.60215,e:0.006787,L:337.2248},{jd:2456400.5,i:3.3949,o:76.801,p:132.03,a:0.723331,n:1.60214,e:0.006785,L:41.3121},{jd:2456440.5,i:3.3949,o:76.802,p:131.97,a:0.723333,n:1.60213,e:0.00678,L:105.398},{jd:2456480.5,i:3.3949,o:76.803,p:131.96,a:0.723325,n:1.60216,e:0.006769,L:169.4851},{jd:2456520.5,i:3.3949,o:76.804,p:131.99,a:0.723327,n:1.60215,e:0.006769,L:233.5729},{jd:2456560.5,i:3.3949,o:76.806,p:132.03,a:0.723328,n:1.60214,e:0.00677,L:297.6598},{jd:2456600.5,i:3.3949,o:76.807,p:132.03,a:0.723326,n:1.60215,e:0.006775,L:1.7475},{jd:2456640.5,i:3.3949,o:76.808,p:131.89,a:0.723337,n:1.60211,e:0.006775,L:65.8345},{jd:2456680.5,i:3.3948,o:76.808,p:131.63,a:0.723345,n:1.60209,e:0.00677,L:129.9169}]},{name:"E",elements:[{jd:2450680.5,i:0.00041,o:349.2,p:102.8517,a:1.00002,n:0.9855796,e:0.0166967,L:328.40353},{jd:2456280.5,i:0,o:349.2,p:103.042,a:1.000008,n:0.985598,e:0.016703,L:87.995},{jd:2456320.5,i:0,o:349.2,p:103.005,a:0.999986,n:0.985631,e:0.016682,L:127.4201},{jd:2456360.5,i:0,o:349.2,p:102.99,a:0.999978,n:0.985642,e:0.016675,L:166.8472},{jd:2456400.5,i:0,o:349.2,p:103.022,a:0.999987,n:0.98563,e:0.016677,L:206.274},{jd:2456440.5,i:0,o:349.2,p:103.077,a:1,n:0.985611,e:0.016677,L:245.6993},{jd:2456480.5,i:0,o:349.2,p:103.119,a:1.000005,n:0.985603,e:0.016675,L:285.1238},{jd:2456520.5,i:0,o:349.2,p:103.147,a:1,n:0.985611,e:0.016679,L:324.5489},{jd:2456560.5,i:0,o:349.2,p:103.161,a:0.999995,n:0.985618,e:0.016682,L:3.9752},{jd:2456600.5,i:0,o:349.2,p:103.146,a:1.000002,n:0.985608,e:0.01669,L:43.402},{jd:2456640.5,i:0,o:349.2,p:103.135,a:1.00001,n:0.985596,e:0.016698,L:82.8279},{jd:2456680.5,i:0,o:349.2,p:103.166,a:1.000005,n:0.985603,e:0.016693,L:122.2544}]},{name:"Ma",radius:3386,interval:1,colour:"rgb(255,50,50)",magnitude:function(i){return -1.51+5*g(i.r*i.R)+0.016*i.FV},elements:[{jd:2450680.5,i:1.84992,o:49.5664,p:336.0882,a:1.5236365,n:0.5240613,e:0.0934231,L:262.42784},{jd:2456280.5,i:1.8497,o:49.663,p:336.246,a:1.523624,n:0.524069,e:0.093285,L:317.1847},{jd:2456320.5,i:1.8497,o:49.664,p:336.249,a:1.523605,n:0.524079,e:0.093274,L:338.1493},{jd:2456360.5,i:1.8497,o:49.665,p:336.255,a:1.523601,n:0.524081,e:0.093269,L:359.115},{jd:2456400.5,i:1.8497,o:49.666,p:336.268,a:1.523627,n:0.524068,e:0.093276,L:20.0806},{jd:2456440.5,i:1.8497,o:49.667,p:336.287,a:1.523678,n:0.524041,e:0.093292,L:41.0443},{jd:2456480.5,i:1.8496,o:49.668,p:336.306,a:1.523731,n:0.524014,e:0.093316,L:62.0048},{jd:2456520.5,i:1.8496,o:49.668,p:336.322,a:1.523762,n:0.523998,e:0.093346,L:82.9625},{jd:2456560.5,i:1.8495,o:49.666,p:336.329,a:1.523748,n:0.524005,e:0.093385,L:103.9196},{jd:2456600.5,i:1.8495,o:49.665,p:336.333,a:1.523709,n:0.524025,e:0.093425,L:124.8784},{jd:2456640.5,i:1.8495,o:49.665,p:336.333,a:1.523665,n:0.524048,e:0.093458,L:145.8405},{jd:2456680.5,i:1.8495,o:49.665,p:336.33,a:1.523631,n:0.524066,e:0.093482,L:166.8051}]},{name:"J",radius:69173,interval:10,colour:"rgb(255,150,150)",magnitude:function(i){return -9.25+5*g(i.r*i.R)+0.014*i.FV},elements:[{jd:2456280.5,i:1.3033,o:100.624,p:14.604,a:5.20269,n:0.083094,e:0.048895,L:68.0222},{jd:2456320.5,i:1.3033,o:100.624,p:14.591,a:5.20263,n:0.083095,e:0.048893,L:71.3469},{jd:2456360.5,i:1.3033,o:100.625,p:14.588,a:5.20262,n:0.083095,e:0.048895,L:74.6719},{jd:2456400.5,i:1.3033,o:100.626,p:14.589,a:5.20262,n:0.083095,e:0.048896,L:77.9971},{jd:2456440.5,i:1.3033,o:100.627,p:14.586,a:5.20259,n:0.083096,e:0.048892,L:81.3228},{jd:2456480.5,i:1.3033,o:100.628,p:14.568,a:5.2025,n:0.083098,e:0.048888,L:84.6481},{jd:2456520.5,i:1.3033,o:100.629,p:14.556,a:5.20245,n:0.083099,e:0.048892,L:87.9728},{jd:2456560.5,i:1.3033,o:100.63,p:14.555,a:5.20245,n:0.083099,e:0.048901,L:91.2973},{jd:2456600.5,i:1.3033,o:100.631,p:14.576,a:5.20254,n:0.083097,e:0.048907,L:94.6223},{jd:2456640.5,i:1.3033,o:100.632,p:14.593,a:5.20261,n:0.083096,e:0.048901,L:97.9485},{jd:2456680.5,i:1.3033,o:100.633,p:14.592,a:5.20259,n:0.083096,e:0.048891,L:101.2751}]},{name:"S",radius:57316,interval:10,colour:"rgb(200,150,150)",magnitude:function(n){var k=Math.atan2(n.y,n.x);var i=Math.atan2(n.z,Math.sqrt(n.x*n.x+n.y*n.y));while(k<0){k+=2*Math.PI}while(k>=360){k-=2*Math.PI}var l=n.d2r*28.06;var m=n.d2r*(169.51+0.0000382*(n.jd-2451543.5));var o=Math.asin(Math.sin(i)*Math.cos(l)-Math.cos(i)*Math.sin(l)*Math.sin(k-m));return -9+5*g(n.r*n.R)+0.044*n.FV+(-2.6*Math.sin(Math.abs(o))+1.2*Math.pow(Math.sin(o),2))},elements:[{jd:2456280.5,i:2.4869,o:113.732,p:90.734,a:9.51836,n:0.033583,e:0.055789,L:208.6057},{jd:2456320.5,i:2.4869,o:113.732,p:90.856,a:9.51931,n:0.033578,e:0.055791,L:209.943},{jd:2456360.5,i:2.4869,o:113.732,p:90.979,a:9.52024,n:0.033574,e:0.055794,L:211.2797},{jd:2456400.5,i:2.4869,o:113.733,p:91.105,a:9.52121,n:0.033568,e:0.055793,L:212.6162},{jd:2456440.5,i:2.4869,o:113.732,p:91.245,a:9.52234,n:0.033562,e:0.055779,L:213.9525},{jd:2456480.5,i:2.4869,o:113.732,p:91.38,a:9.52349,n:0.033556,e:0.05575,L:215.2901},{jd:2456520.5,i:2.4869,o:113.732,p:91.5,a:9.5245,n:0.033551,e:0.055724,L:216.6279},{jd:2456560.5,i:2.487,o:113.732,p:91.611,a:9.52541,n:0.033546,e:0.055704,L:217.9654},{jd:2456600.5,i:2.487,o:113.732,p:91.727,a:9.5263,n:0.033541,e:0.055691,L:219.3014},{jd:2456640.5,i:2.487,o:113.732,p:91.87,a:9.52748,n:0.033535,e:0.055657,L:220.6368},{jd:2456680.5,i:2.487,o:113.733,p:92.021,a:9.52885,n:0.033528,e:0.0556,L:221.973}]},{name:"U",radius:25266,interval:20,colour:"rgb(130,150,255)",magnitude:function(i){return -7.15+5*g(i.r*i.R)+0.001*i.FV},elements:[{jd:2456280.5,i:0.7726,o:74.004,p:169.227,a:19.2099,n:0.011713,e:0.046728,L:9.14},{jd:2456320.5,i:0.7727,o:74.001,p:169.271,a:19.2064,n:0.011716,e:0.046913,L:9.6133},{jd:2456360.5,i:0.7727,o:73.997,p:169.314,a:19.203,n:0.01172,e:0.047102,L:10.0873},{jd:2456400.5,i:0.7727,o:73.991,p:169.364,a:19.1994,n:0.011723,e:0.047297,L:10.561},{jd:2456440.5,i:0.7728,o:73.989,p:169.434,a:19.1953,n:0.011727,e:0.047509,L:11.034},{jd:2456480.5,i:0.7728,o:73.989,p:169.522,a:19.1916,n:0.01173,e:0.047703,L:11.5048},{jd:2456520.5,i:0.7728,o:73.989,p:169.602,a:19.1882,n:0.011733,e:0.047874,L:11.9756},{jd:2456560.5,i:0.7728,o:73.989,p:169.674,a:19.185,n:0.011736,e:0.048035,L:12.447},{jd:2456600.5,i:0.7728,o:73.985,p:169.74,a:19.1816,n:0.011739,e:0.048215,L:12.92},{jd:2456640.5,i:0.7728,o:73.984,p:169.836,a:19.1774,n:0.011743,e:0.048431,L:13.392},{jd:2456680.5,i:0.7728,o:73.983,p:169.962,a:19.1729,n:0.011747,e:0.04865,L:13.8617}]},{name:"N",radius:24553,interval:20,colour:"rgb(100,100,255)",magnitude:function(i){return -6.9+5*g(i.r*i.R)+0.001*i.FV},elements:[{jd:2456280.5,i:1.7686,o:131.93,p:53.89,a:30.0401,n:0.00599,e:0.010281,L:333.6121},{jd:2456320.5,i:1.7687,o:131.932,p:55.15,a:30.0331,n:0.005992,e:0.010207,L:333.8487},{jd:2456360.5,i:1.7688,o:131.935,p:56.47,a:30.0259,n:0.005994,e:0.010138,L:334.0856},{jd:2456400.5,i:1.7688,o:131.937,p:57.82,a:30.0185,n:0.005996,e:0.010067,L:334.322},{jd:2456440.5,i:1.769,o:131.94,p:59.24,a:30.0108,n:0.005999,e:0.009985,L:334.5566},{jd:2456480.5,i:1.7691,o:131.943,p:60.44,a:30.0044,n:0.006,e:0.009894,L:334.7895},{jd:2456520.5,i:1.7692,o:131.946,p:61.52,a:29.9987,n:0.006002,e:0.009816,L:335.0233},{jd:2456560.5,i:1.7693,o:131.949,p:62.57,a:29.9932,n:0.006004,e:0.009748,L:335.2581},{jd:2456600.5,i:1.7694,o:131.951,p:63.84,a:29.9867,n:0.006006,e:0.00969,L:335.4937},{jd:2456640.5,i:1.7695,o:131.954,p:65.29,a:29.9793,n:0.006008,e:0.009609,L:335.7265},{jd:2456680.5,i:1.7697,o:131.957,p:66.66,a:29.9725,n:0.00601,e:0.009508,L:335.9564}]}];this.d2r=Math.PI/180;this.r2d=180/Math.PI;this.AUinkm=149597870.7;return this}j.prototype.build=function(m,n){var k=new Array(this.planets.length-1);var i=0;if(!n){n=365.25}for(var l=0;l<this.planets.length;l++){if(this.planets[l].colour){k[i++]=this.buildPlanet(l,m,n)}}return k};j.prototype.buildPlanet=function(o,v,x){var k,t,l,m,w;if(typeof o==="number"){k=o}else{var s=-1;for(var u=0;u<this.planets.length;u++){if(this.planets[u].name==o){s=u}}if(s<0){return this}if(s==2){return this}k=s}l=(typeof this.planets[k].interval==="number"?this.planets[k].interval:1);m=Math.floor(x/l);var r=new Array(3);r[0]=this.planets[k]["name"];r[1]=this.planets[k]["colour"];r[2]=new Array(m*4);w=v;for(var q=0;q<m;q++){w+=l;t=this.getEphem(k,w);r[2][q*4+0]=w;r[2][q*4+1]=t[0];r[2][q*4+2]=t[1];r[2][q*4+3]=t[2]}return r};j.prototype.getEphem=function(w,C){var D,u,E,s,r,p,n,A,B,G,m,k,H,l;if(typeof w==="number"){D=w}else{var o=-1;for(var F=0;F<this.planets.length;F++){if(this.planets[F].name==w){o=F}}if(o<0){return this}if(o==2){return this}D=o}u=this.getHeliocentric(this.planets[D],C);E=this.getHeliocentric(this.planets[2],C);s=u.xyz[0]-E.xyz[0];r=u.xyz[1]-E.xyz[1];p=u.xyz[2]-E.xyz[2];n=23.439292*this.d2r;A=[s,r*Math.cos(n)-p*Math.sin(n),r*Math.sin(n)+p*Math.cos(n)];B=Math.atan(A[1]/A[0])*this.r2d;if(A[0]<0){B+=180}if(A[0]>=0&&A[1]<0){B+=360}G=Math.atan(A[2]/Math.sqrt(A[0]*A[0]+A[1]*A[1]))*this.r2d;m=Math.sqrt(A[0]*A[0]+A[1]*A[1]+A[2]*A[2]);var t=(this.planets[D].radius*2/(m*this.AUinkm));k=1;H=Math.acos((u.r*u.r+m*m-E.r*E.r)/(2*u.r*m));l=(1+Math.cos(H))/2;k=this.planets[D].magnitude({a:u.r,r:u.r,R:m,FV:H*this.r2d,x:s,y:r,z:p,jd:C,d2r:this.d2r});return[B,G,k]};j.prototype.getHeliocentric=function(q,w,s){var o=10000000000;var m,l,u,t,x,k;if(!s){for(var n=0;n<q.elements.length;n++){m=Math.abs(q.elements[n].jd-w);if(m<o){s=n}o=m}}l=q.elements[s];u=(w-l.jd);t=this.meanAnomaly(l.n,u,l.L,l.p);x=this.trueAnomaly(t*this.d2r,l.e,10);k=l.a*(1-Math.pow(l.e,2))/(1+l.e*Math.cos(x*this.d2r));return{xyz:this.heliocentric(x*this.d2r,k,l.p*this.d2r,l.o*this.d2r,l.i*this.d2r),M:t,v:x,r:k,i:s,d:u,elements:l}};j.prototype.meanAnomaly=function(l,o,i,k){var m=o*l+i-k;while(m<0){m+=360}while(m>=360){m-=360}return m};j.prototype.heliocentric=function(y,k,m,q,t){var x=y+m-q;var w=Math.sin(x);var l=Math.cos(x);var u=Math.cos(q);var n=Math.sin(q);var z=Math.cos(t);var s=Math.sin(t);return[k*(u*l-n*w*z),k*(n*l+u*w*z),k*(w*s)]};j.prototype.trueAnomaly=function(i,n,k){var o=i;if(typeof k==="number"){var p=0.05;var k=10;while(Math.abs(p)>=Math.pow(10,-k)){p=o-n*Math.sin(o)-i;o-=p/(1-n*Math.cos(o))}var l=2*Math.atan(Math.pow(((1+n)/(1-n)),0.5)*Math.tan(0.5*o));if(l<0){l+=Math.PI*2}}else{l=i+((2*n-Math.pow(n,3)/4)*Math.sin(i)+1.25*Math.pow(n,2)*Math.sin(2*i)+(13/12)*Math.pow(n,3)*Math.sin(3*i))}return l*this.r2d};function a(p,q){var o,k,n,l,m,i;p/=15;o=Math.floor(p);k=Math.floor((p-o)*60);n=(p-o-k/60)*3600;l=Math.floor(q);m=Math.floor((q-l)*60);i=(q-l-m/60)*3600;return(Math.abs(o)<10?"0":"")+o+":"+(k<10?"0":"")+k+":"+(n<10?"0":"")+n.toFixed(2)+" "+(Math.abs(l)<10?"0":"")+l+":"+(m<10?"0":"")+m+":"+(i<10?"0":"")+i.toFixed(2)}function b(i){if(!i){i=new Date()}return(i.getTime()/86400000)+2440587.5}function f(i){return i-Math.floor(i/360)*360}function g(i){return Math.LOG10E*Math.log(i)}var e=false;for(var c=0;c<d.virtualsky.plugins.length;c++){if(d.virtualsky.plugins[c].name=="planets"){e=true}}if(!e){d.virtualsky.plugins.push({init:h,name:"planets",version:"1.0"})}})(jQuery);